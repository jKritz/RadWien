---
title: "RadWien 2016"
output: html_notebook
---

## Anforderungen

die Studie soll folgende Fragestellungen behandeln:

+ Ranking Messstellen 
+ Jahreswerte je Monat und Messtelle
+ Jahreswerte je Tag als time-series
+ Vergleich Arbeitstage mit Wochendende
+ BoxplotÜbersicht
+ Tagesranking

### Libraries
```{r Libraries}
library(tidyverse)
library(lubridate)
```

### Data
```{r Get data}
r16 <- read_delim("~/AnacondaProjects/R/Projekte/RadWien/data/rad_vz_2016.csv", 
                  ";", escape_double = FALSE, 
                  col_types = cols(Datum = col_date(format = "%Y%m%d")), 
                  trim_ws = TRUE)
r16 <- r16[,-c(8,9)] 
# Opernring nurSumme von (Innenringe,Außenring)
```
## Umformung
```{r Umformung}
r16_m <- r16 %>% 
  mutate (Monate=floor_date(Datum,unit='month')) %>% 
  select(-Datum) %>% 
  gather(mess,values,-Monate)

r16_d <- r16 %>% 
  mutate (Tage=floor_date(Datum,unit='day')) %>% 
  select(-Datum) %>% 
  gather(mess,values,-Tage)
```
## Jahressummen
```{r Jahressummen}
r16_m %>% 
  group_by(mess) %>%
  summarise(sum=sum(values)) %>%
  ggplot(aes(x=reorder(mess,-sum),sum))+
    geom_col()+
    theme(axis.text.x = element_text(angle = 90, hjust = 1))+
    labs(x="Messstellen",y="Anzahl",title="Ganzjahressummen")
```
## Jahresverlauf an den Messpunkten (absolut)
```{r Jahresverlauf}
ggplot(r16_m,aes(x=Monate,y=values))+
  geom_col()+
  facet_wrap(vars(mess))+
  theme_gray(base_size=9)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
    labs(y="Anzahl",title="Anzahl im Jahresverlauf")

```
## Jahresverlauf an den Messpunkten (Entwicklung Tagesanzahl)
```{r Tagesverlauf}
ggplot(r16_d,aes(x=Tage,y=values))+
    geom_point(aes(alpha=0.5),color='red')+
    geom_smooth()+
    facet_wrap(vars(mess))+
    theme_gray(base_size=10)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1))+
    ggtitle("Tageswerte an den Messtellen")
```
## Vergleich der Fahrten an Arbeitstagen und am Wochenende
```{r Wochentage}
r16_d<-r16_d%>%
   mutate(wt=as_factor(if_else((wday(Tage)%in% c(1,7)),'ft','at')))
 
r16_d%>%
   group_by(mess,wt)%>%
   summarise(mw=mean(values))%>%
   ggplot(aes(mess,mw,fill=wt))+
   geom_bar(stat='identity',position="fill")+coord_flip()+
   labs(y="Mittelwertvergleich",x="Messpunkt",title="Verhältnis Werktage zu Wochenendtage")+
   scale_fill_discrete(name='Wochentag',
                       labels=c('Arbeitstag',"Wochenende"))+
   theme(panel.grid.major.x = element_line(colour="white",size=2.0))
```

```{r Tagesranking}
t <- r16_d %>% 
  group_by(Tage) %>% 
  summarise(sum=sum(values)) %>% 
  filter(rank(desc(sum))<=10)

  ggplot(t,aes(x=1:10,y=sum))+
    geom_bar(stat="identity")+
    labs(y="Summe",title="Stärkste Tage")+
    scale_x_continuous(name="Tage",breaks=c(1:10),labels=t$Tage)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

